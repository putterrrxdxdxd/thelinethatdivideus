<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Line That Divide Us</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            background: #111;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }
        #stage {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        video, img {
            position: absolute;
            width: 320px;
            height: 240px;
            border: none;
            border-radius: 0;
            box-shadow: none;
            cursor: grab;
            object-fit: cover;
        }
        #drop-zone {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            border: 2px dashed rgba(255,255,255,0.3);
            display: none;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 1.5em;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="stage">
        <div id="drop-zone">Drop file here</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    <script>
        let highestZ = 1;
        const stage = document.getElementById('stage');
        const dropZone = document.getElementById('drop-zone');

        function bringToFront(el) {
            highestZ++;
            el.style.zIndex = highestZ;
        }

        function makeInteractive(el) {
            bringToFront(el);
            interact(el)
                .draggable({
                    listeners: {
                        start(event) {
                            bringToFront(event.target);
                        },
                        move(event) {
                            const target = event.target;
                            const x = (parseFloat(target.dataset.x) || 0) + event.dx;
                            const y = (parseFloat(target.dataset.y) || 0) + event.dy;
                            target.style.transform = `translate(${x}px, ${y}px)`;
                            target.dataset.x = x;
                            target.dataset.y = y;

                            if (event.shiftKey) {
                                let z = parseInt(target.style.zIndex || 1);
                                const delta = event.dy;
                                if (delta < 0) z++;
                                else if (delta > 0 && z > 1) z--;
                                target.style.zIndex = z;
                            }
                        }
                    }
                })
                .resizable({
                    edges: { left: true, right: true, bottom: true, top: true },
                    listeners: {
                        move(event) {
                            const target = event.target;
                            target.style.width = `${event.rect.width}px`;
                            target.style.height = `${event.rect.height}px`;
                        }
                    }
                });
        }

        // Keyboard Shortcuts
        document.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            if (key === 'w') spawnWebcam();
            if (key === 'v') spawnVideo();
            if (key === 'i') spawnImage();
        });

        function spawnWebcam() {
            const webcam = document.createElement('video');
            webcam.autoplay = true;
            webcam.playsInline = true;
            webcam.muted = true;
            webcam.style.position = 'absolute';
            webcam.style.top = '100px';
            webcam.style.left = '100px';
            webcam.width = 320;
            webcam.height = 240;
            stage.appendChild(webcam);
            makeInteractive(webcam);

            navigator.mediaDevices.getUserMedia({ video: true, audio: false })
                .then(stream => { webcam.srcObject = stream; })
                .catch(err => console.error('Webcam error:', err));
        }

        function spawnVideo() {
            const video = document.createElement('video');
            video.src = 'archives/video1.mp4'; // Replace with your video
            video.autoplay = true;
            video.loop = true;
            video.muted = true;
            video.controls = true;
            video.style.position = 'absolute';
            video.style.top = '150px';
            video.style.left = '150px';
            video.width = 320;
            video.height = 240;
            stage.appendChild(video);
            makeInteractive(video);
        }

        function spawnImage() {
            const img = document.createElement('img');
            img.src = 'archives/image1.jpg'; // Replace with your image
            img.style.position = 'absolute';
            img.style.top = '200px';
            img.style.left = '200px';
            img.width = 320;
            img.height = 240;
            stage.appendChild(img);
            makeInteractive(img);
        }

        // Drag & Drop Files
        window.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.display = 'flex';
        });
        window.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.style.display = 'none';
        });
        window.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.display = 'none';

            const files = e.dataTransfer.files;
            for (let file of files) {
                const url = URL.createObjectURL(file);

                if (file.type.startsWith('video/')) {
                    const video = document.createElement('video');
                    video.src = url;
                    video.autoplay = true;
                    video.loop = true;
                    video.muted = true;
                    video.controls = true;
                    video.style.position = 'absolute';
                    video.style.top = '100px';
                    video.style.left = '100px';
                    video.width = 320;
                    video.height = 240;
                    stage.appendChild(video);
                    makeInteractive(video);
                } else if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = url;
                    img.style.position = 'absolute';
                    img.style.top = '100px';
                    img.style.left = '100px';
                    img.width = 320;
                    img.height = 240;
                    stage.appendChild(img);
                    makeInteractive(img);
                } else {
                    alert('Unsupported file type: ' + file.type);
                }
            }
        });
    </script>
</body>
</html>

<script>
let hoveredElement = null; // Track hovered element

// 🖱 Detect when mouse enters/leaves an element
document.querySelectorAll('video, img').forEach(el => {
    el.addEventListener('mouseenter', () => hoveredElement = el);
    el.addEventListener('mouseleave', () => hoveredElement = null);
});

// 🎨 Helper to parse current filters
function getCurrentFilters(el) {
    const filter = el.style.filter || '';
    const filters = {};
    filter.split(' ').forEach(f => {
        if (f.includes('grayscale')) filters.grayscale = true;
        if (f.includes('blur')) filters.blur = true;
        if (f.includes('invert')) filters.invert = true;
    });
    return filters;
}

// 🎨 Helper to update filters
function updateFilters(el, filters) {
    const applied = [];
    if (filters.grayscale) applied.push('grayscale(100%)');
    if (filters.blur) applied.push('blur(5px)');
    if (filters.invert) applied.push('invert(100%)');
    el.style.filter = applied.join(' ') || 'none';
}

// 🎹 Keyboard Shortcuts for hovered element
document.addEventListener('keydown', (e) => {
    if (!hoveredElement) return; // Nothing hovered, skip

    const key = e.key.toLowerCase();
    let filters = getCurrentFilters(hoveredElement);

    // 🔥 Opacity control
    if (key === 'arrowup') {
        let opacity = parseFloat(hoveredElement.style.opacity) || 1;
        opacity = Math.min(opacity + 0.1, 1);
        hoveredElement.style.opacity = opacity;
    }
    if (key === 'arrowdown') {
        let opacity = parseFloat(hoveredElement.style.opacity) || 1;
        opacity = Math.max(opacity - 0.1, 0);
        hoveredElement.style.opacity = opacity;
    }

    // 🎨 Filter toggles
    if (key === 'g') {
        filters.grayscale = !filters.grayscale;
        updateFilters(hoveredElement, filters);
    }
    if (key === 'b') {
        filters.blur = !filters.blur;
        updateFilters(hoveredElement, filters);
    }
    if (key === 'i') {
        filters.invert = !filters.invert;
        updateFilters(hoveredElement, filters);
    }
    if (key === 'c') {
        // Clear all filters
        hoveredElement.style.filter = 'none';
    }

    // ❌ Delete object
    if (key === 'x') {
        hoveredElement.remove();
        hoveredElement = null;
    }
});

// 🪄 Also apply hover tracking to new elements created later
// reuse stage defined earlier
const observer = new MutationObserver(mutations => {
    mutations.forEach(mutation => {
        mutation.addedNodes.forEach(node => {
            if (node.tagName === 'VIDEO' || node.tagName === 'IMG') {
                node.addEventListener('mouseenter', () => hoveredElement = node);
                node.addEventListener('mouseleave', () => hoveredElement = null);
            }
        });
    });
});
observer.observe(stage, { childList: true });
</script>
<script>
// 🎛 Mini Control Panel
const panel = document.createElement('div');
panel.style.position = 'fixed';
panel.style.bottom = '20px';
panel.style.right = '20px';
panel.style.background = 'rgba(0,0,0,0.7)';
panel.style.padding = '10px';
panel.style.borderRadius = '8px';
panel.style.display = 'flex';
panel.style.flexDirection = 'column';
panel.style.gap = '8px';
panel.style.zIndex = 9999;

const btnWebcam = document.createElement('button');
btnWebcam.textContent = 'Add Webcam';
btnWebcam.onclick = spawnWebcam;

const btnScreen = document.createElement('button');
btnScreen.textContent = 'Share Screen';
btnScreen.onclick = addScreenShare;

const btnFile = document.createElement('button');
btnFile.textContent = 'Add File';
btnFile.onclick = () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'video/*,image/*';
    input.onchange = e => handleFile(e.target.files[0]);
    input.click();
};

panel.appendChild(btnWebcam);
panel.appendChild(btnScreen);
panel.appendChild(btnFile);
document.body.appendChild(panel);

// 🖥 Screen Share
async function addScreenShare() {
    try {
        const stream = await navigator.mediaDevices.getDisplayMedia({
            video: true,
            audio: false
        });
        const video = document.createElement('video');
        video.srcObject = stream;
        video.autoplay = true;
        video.muted = true;
        video.style.position = 'absolute';
        video.style.top = '120px';
        video.style.left = '120px';
        video.style.width = '400px';
        video.style.height = '300px';
        stage.appendChild(video);
        makeInteractive(video);
    } catch (err) {
        console.error('Screen share error:', err);
    }
}

// 📁 Handle dropped or uploaded file
function handleFile(file) {
    if (!file) return;
    const url = URL.createObjectURL(file);

    if (file.type.startsWith('video/')) {
        const video = document.createElement('video');
        video.src = url;
        video.autoplay = true;
        video.loop = true;
        video.muted = true;
        video.controls = true;
        video.style.position = 'absolute';
        video.style.top = '150px';
        video.style.left = '150px';
        video.style.width = '320px';
        video.style.height = '240px';
        stage.appendChild(video);
        makeInteractive(video);
    } else if (file.type.startsWith('image/')) {
        const img = document.createElement('img');
        img.src = url;
        img.style.position = 'absolute';
        img.style.top = '150px';
        img.style.left = '150px';
        img.style.width = '320px';
        img.style.height = '240px';
        stage.appendChild(img);
        makeInteractive(img);
    } else {
        alert('Unsupported file type: ' + file.type);
    }
}

// 🎹 Keyboard Shortcuts
document.addEventListener('keydown', (e) => {
    switch (e.key.toLowerCase()) {
        case 'w':
            spawnWebcam();
            break;
        case 's':
            addScreenShare();
            break;
        case 'd':
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'video/*,image/*';
            input.onchange = ev => handleFile(ev.target.files[0]);
            input.click();
            break;
        case 'delete':
            if (hoveredElement) {
                hoveredElement.remove();
                hoveredElement = null;
            }
            break;
    }
});

// 🗑 Remove hovered element on Delete
stage.addEventListener('mouseover', (e) => {
    if (e.target.tagName === 'VIDEO' || e.target.tagName === 'IMG') {
        hoveredElement = e.target;
        e.target.style.outline = '2px solid red';
    }
});
stage.addEventListener('mouseout', (e) => {
    if (e.target === hoveredElement) {
        e.target.style.outline = 'none';
        hoveredElement = null;
    }
});
</script>